(()=>{"use strict";var e,t=function(){return t=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},t.apply(this,arguments)},n="GameEvents";!function(e){e.preloadRewarded="preloadRewarded",e.showRewarded="showRewarded",e.preloadInterstitial="preloadInterstitial",e.showInterstitial="showInterstitial",e.pong="pong",e.ping="ping",e.getUser="getUser",e.userInfo="userInfo",e.getPlatformInfo="getPlatformInfo",e.platformInfo="platformInfo",e.authorizeUser="authorizeUser",e.getState="getState",e.initStorage="initStorage",e.setItems="setItems",e.deleteItems="deleteItems",e.getCloudSaveState="getCloudSaveState",e.setCloudSaveState="setCloudSaveState",e.deleteCloudSaveKeys="deleteCloudSaveKeys",e.cloudSaveStateResponse="cloudSaveStateResponse",e.cloudSaveOperationResponse="cloudSaveOperationResponse",e.requestPurchase="requestPurchase",e.requestTopup="requestTopup",e.purchaseStatus="purchaseStatus",e.topupStatus="topupStatus",e.unknownMessageAction="unknownMessageAction",e.unknownMessageType="unknownMessageType",e.subscribeToAdStateChanges="subscribeToAdStateChanges",e.adStateChanged="adStateChanged",e.gameReady="gameReady"}(e||(e={}));const a=function(){function e(){}return e.prototype.send=function(e){var a="".concat(Date.now(),"-").concat(Math.random());return window.parent.postMessage(t(t({payload:{}},e),{id:a,source:n,ver:1}),"*"),a},e}();var r,s,o;!function(e){e.not_started="not_started",e.start="start",e.error="error",e.empty="empty",e.done="done",e.rewarded="rewarded",e.close="close",e.open="open",e.show="show"}(s||(s={})),function(e){e.interstitial="interstitial",e.rewarded="rewarded"}(o||(o={}));var i=((r={})[e.showInterstitial]=o.interstitial,r[e.preloadInterstitial]=o.interstitial,r[e.showRewarded]=o.rewarded,r[e.preloadRewarded]=o.rewarded,r),l=function(){function t(e){var t=e.messageSender;this.interstitialState=s.not_started,this.rewardedState=s.not_started,this.rewardedBannerCallbacks=null,this.interstitialBannerCallbacks=null,this.onStateChanged=null,this.messageSender=t}return t.prototype.messageHandler=function(t){var n,a=t.action,r=t.payload;if(r){switch(a){case e.preloadInterstitial:case e.showInterstitial:this.interstitialState=r.status;break;case e.preloadRewarded:case e.showRewarded:this.rewardedState=r.status;break;case e.adStateChanged:return void(null===(n=this.onStateChanged)||void 0===n||n.call(this,r.adType,r.status));default:return}var o="interstitial"===i[a]?this.interstitialBannerCallbacks:this.rewardedBannerCallbacks;if(o)switch(r.status){case s.done:o.onReady&&o.onReady();break;case s.empty:o.onEmpty&&o.onEmpty(),this.rewardedBannerCallbacks=null,this.interstitialBannerCallbacks=null;break;case s.error:o.onError&&o.onError(),this.rewardedBannerCallbacks=null,this.interstitialBannerCallbacks=null;break;case s.open:o.onOpen&&o.onOpen();break;case s.close:o.onClose&&o.onClose(),this.rewardedBannerCallbacks=null,this.interstitialBannerCallbacks=null;break;case s.rewarded:this.rewardedBannerCallbacks&&this.rewardedBannerCallbacks.onRewarded&&this.rewardedBannerCallbacks.onRewarded()}}},t.prototype.showInterstitial=function(t){this.interstitialBannerCallbacks=t,this.messageSender.send({action:e.showInterstitial,type:"adv"})},t.prototype.showRewarded=function(t){this.rewardedBannerCallbacks=t,this.messageSender.send({action:e.showRewarded,type:"adv"})},t.prototype.prepareInterstitial=function(t){this.interstitialBannerCallbacks=t,this.messageSender.send({action:e.preloadInterstitial,type:"adv"})},t.prototype.prepareRewarded=function(t){this.rewardedBannerCallbacks=t,this.messageSender.send({action:e.preloadRewarded,type:"adv"})},t.prototype.subscribeToAdStateChanges=function(t){this.onStateChanged=t,this.messageSender.send({action:e.subscribeToAdStateChanges,type:"adv"})},t}();const u=l;var c=function(e,t){void 0===t&&(t=5e3);var n={};return{sendMessage:function(a){var r,s,o=e.send(a);return n[o]={promise:new Promise((function(e,t){r=e,s=t})),resolve:r,reject:s,status:"pending"},setTimeout((function(){var e=n[o];e&&("pending"===e.status?(e.status="timeout",e.reject(new Error("Timeout"))):delete n[o])}),t),n[o].promise},messageHandler:function(e){if(!e.responseToId)throw new Error("Message without ID");var t=n[e.responseToId];if(!(null==t?void 0:t.resolve))throw new Error("Request not found");"pending"===t.status?(t.resolve(e),t.status="complete"):delete n[e.responseToId]}}},d=function(){return d=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},d.apply(this,arguments)},p=/^GA::(.+)::ga_(.+)/,f=function(e){return!p.test(e)},h=function(t){return{setItems:function(n){return t.send({type:"storage",action:e.setItems,payload:n})},deleteItems:function(n){return t.send({type:"storage",action:e.deleteItems,payload:{keys:n}})}}},v=function(e,t,n,a){return new(n||(n=Promise))((function(r,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}l((a=a.apply(e,t||[])).next())}))},y=function(e,t){var n,a,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},g=function(t,n){var a,r;return{inGamePaymentsMessageHandler:function(t){t.action===e.purchaseStatus&&a(t.payload)},inGamePaymentsApi:{purchase:function(s){return o=void 0,i=void 0,u=function(){var o,i;return function(e,t){var n,a,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(l){switch(l.label){case 0:return[4,n.getUser()];case 1:return(null==(o=l.sent())?void 0:o.isAuthorized)?[3,3]:[4,n.authorizeUser()];case 2:o=l.sent(),l.label=3;case 3:if(!(null==o?void 0:o.isAuthorized))throw new Error("Purchases are only for registered users");if(!s.amount)throw new Error("Purchase amount not specified");return r=new Promise((function(e){a=e})),t.send({type:"in-game-payments",action:e.requestPurchase,payload:s}),[4,r];case 4:if("FAILED"===(i=l.sent()).status)throw new Error(i.error);return[2,i]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function a(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof l?r:new l((function(e){e(r)}))).then(n,a)}r((u=u.apply(o,i||[])).next())}));var o,i,l,u}}}},w=function(e,t,n,a){return new(n||(n=Promise))((function(r,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}l((a=a.apply(e,t||[])).next())}))},b=function(e,t){var n,a,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},m=function(){function t(e){var t=e.messageSender,n=c(t,12e4),a=n.sendMessage,r=n.messageHandler;this.sendMessage=a,this.postMessageHandler=r}return t.prototype.getUser=function(){return w(this,void 0,void 0,(function(){return b(this,(function(t){switch(t.label){case 0:return this.cachedUser?[2,this.cachedUser]:[4,this.sendMessage({type:"user",action:e.getUser})];case 1:return[2,t.sent().payload]}}))}))},t.prototype.authorizeUser=function(){return w(this,void 0,void 0,(function(){var t;return b(this,(function(n){switch(n.label){case 0:return[4,this.sendMessage({type:"user",action:e.authorizeUser})];case 1:return t=n.sent(),this.cachedUser=t.payload,[2,t.payload]}}))}))},t.prototype.messageHandler=function(t){var n=t.action,a=t.payload,r=t.responseToId;a&&(r?this.postMessageHandler(t):n===e.userInfo&&(this.cachedUser=a))},t}();const S=m;var k=function(){function t(t){var n=t.messageSender,a=this;this.platformInfo={language:"en"};var r,s=c(n),o=s.sendMessage,i=s.messageHandler;this.postMessageHandler=i,this.isReady=new Promise((function(e){r=e})),o({type:"platform",action:e.getPlatformInfo}).then((function(e){a.platformInfo=e.payload,r()}))}return t.prototype.getLanguage=function(){return this.platformInfo.language},t.prototype.messageHandler=function(t){var n=t.action,a=t.payload,r=t.responseToId;a&&(r?this.postMessageHandler(t):n===e.platformInfo&&(this.platformInfo=a))},t}(),I=function(){function t(e){var t=e.messageSender,n=c(t).sendMessage;this.sendMessage=n}return t.prototype.gameReady=function(){return t=this,n=void 0,r=function(){return function(e,t){var n,a,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(t){switch(t.label){case 0:return[4,this.sendMessage({type:"game",action:e.gameReady})];case 1:return t.sent(),[2]}}))},new((a=void 0)||(a=Promise))((function(e,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function i(e){try{l(r.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(o,i)}l((r=r.apply(t,n||[])).next())}));var t,n,a,r},t}();const C=function(){var t=this;this.isInitialized=!1,this.messageSender=new a,this.advService=new u({messageSender:this.messageSender}),this.userService=new S({messageSender:this.messageSender}),this.platformService=new k({messageSender:this.messageSender}),this.gameService=new I({messageSender:this.messageSender});var r=function(t){var n=c(t),a=n.sendMessage,r=n.messageHandler;return{storageReady:Promise.resolve(),storageMessageHandler:r,storageApi:d({getState:function(){return t=void 0,n=void 0,s=function(){var t,n;return function(e,t){var n,a,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(r){switch(r.label){case 0:return[4,a({type:"storage",action:e.getState})];case 1:return t=r.sent(),[2,(null===(n=t.payload)||void 0===n?void 0:n.state)||{}]}}))},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function i(e){try{l(s.throw(e))}catch(e){a(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,i)}l((s=s.apply(t,n||[])).next())}));var t,n,r,s}},h(t))}}(this.messageSender),s=r.storageMessageHandler,o=r.storageReady,i=r.storageApi;this.storageApi=i;var l=g(this.messageSender,this.userService),p=l.inGamePaymentsMessageHandler,w=l.inGamePaymentsApi;this.inGamePaymentsApi=w;var b=function(t){var n=c(t),a=n.sendMessage;return{cloudSaveMessageHandler:n.messageHandler,cloudSaveApi:{getState:function(){return v(void 0,void 0,void 0,(function(){var t,n,r;return y(this,(function(s){switch(s.label){case 0:return[4,a({type:"cloud-save",action:e.getCloudSaveState})];case 1:return t=s.sent(),n=(null===(r=null==t?void 0:t.payload)||void 0===r?void 0:r.state)||{},0===Object.keys(n).length&&(n=function(){for(var e={},t=0;t<window.localStorage.length;t+=1){var n=window.localStorage.key(t);if(null!==n&&f(n)){var a=window.localStorage.getItem(n);null!==a&&(e[n]=a)}}return e}()),[2,n]}}))}))},setItems:function(t){return v(void 0,void 0,void 0,(function(){var n,r;return y(this,(function(s){switch(s.label){case 0:return[4,a({type:"cloud-save",action:e.setCloudSaveState,payload:t})];case 1:return n=s.sent(),[2,Boolean(null===(r=null==n?void 0:n.payload)||void 0===r?void 0:r.success)]}}))}))}}}}(this.messageSender),m=b.cloudSaveMessageHandler,C=b.cloudSaveApi;this.cloudSaveApi=C,window.addEventListener("message",(function(e){if(e.data.source===n&&e.source)switch(e.data.type){case"liveness":t.isInitialized=!0;break;case"adv":t.advService.messageHandler(e.data);break;case"user":t.userService.messageHandler(e.data);break;case"storage":s(e.data);break;case"in-game-payments":p(e.data);break;case"cloud-save":m(e.data);break;case"platform":t.platformService.messageHandler(e.data)}})),Promise.all([o,this.platformService.isReady]).then((function(){return t.messageSender.send({type:"liveness",action:e.ping,payload:{}})}))};window.PLAYGAMA_SDK=new C})();